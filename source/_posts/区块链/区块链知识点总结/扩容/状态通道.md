---
title: 状态通道

date: 2023-03-25	

categories: 扩容	

tags: [区块链,区块链知识点总结,扩容]
---	

# 状态通道

状态通道让参与者可以安全地进行链下交易，同时最大限度地减少和以太坊主网的交互。 通道对等节点可以进行任意数量的链下交易，并且**只需提交两个链上交易以打开和关闭通道**。 这样便实现了极高的交易吞吐量，并为用户降低了成本。

## 什么是通道？

通道是简单的对等协议，允许双方进行多笔交易，然后只将最终结果发布到区块链。 渠道使用加密算法证明产生的摘要数据确实是一组有效中间交易的结果。 “多重签名"智能合约确保交易由正确的相关方签署。

每条通道都由以太坊上运行的多签智能合约管理。 **要打开一条通道，参与者在链上部署通道合约并将资金存入其中**。 双方**共同签署一个状态**更新来初始化通道的状态，之后他们就可以快速且自由地进行链下交易。

**要关闭通道，参与者需要将各方一致同意的通道最终状态提交到链上**。 然后，智能合约根据通道最终状态下每个参与者的余额分配锁定资金。

对等通道在一些情况下非常有用，比如，某些预先确定的参与者希望频繁进行交易，并且不会产生明显的费用。 区块链通道分为两类：**支付通道**和**状态通道**。

## 支付通道

将支付通道描述成由**两个用户共同维护的“双向账本”**最为恰当。 账本的**初始余额是通道打开期间锁定在链上合约中的存款总和**。 支付通道转账可以立刻执行，并且除了最初建立一次性链上通道以及通道的最终关闭外，其余部分无需区块链实际参与。账本余额的更新需要渠道中所有各方的批准。 **通道更新在所有通道参与者签署后被视为最终确定**，这和以太坊上的交易非常相似。

## 状态通道

除了支持链下支付外，尚未证实支付通道可用于处理通用状态转换逻辑。 创建状态通道是为了解决这个问题，并使通道可用于扩展通用计算。

**状态通道与支付通道仍有很多共同点**。 例如，当用户通过交换加密签名的信息（交易）进行互动时，另一些通道参与者也必须对信息签名。 如果提出的状态更新没有获得所有参与者的签名，则认为是无效的。

但是，除了保存用户的余额外，通道还跟踪合约存储的当前状态（即合约变量的值）。

这使得两个用户之间可以在链下执行智能合约。 在这种情况下，**智能合约内部状态的更新只需由创建通道的另一方批准即可**。

虽然这**解决了前文描述的可扩展性问题，但它对安全性有影响**。 在以太坊上，以太坊状态转换的有效性由网络的共识协议强制执行。 因此，不可能对智能合约的状态提出无效更新或者修改智能合约的执行。状态通道没有同样的安全保障。 在某种程度上，状态通道是主网的缩影。 **由于执行规则的参与者有限，发生恶意行为（例如，提出无效状态更新）的可能性增加**。 状态通道的安全性来自基于欺诈证明的争议仲裁系统。