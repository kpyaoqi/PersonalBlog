---
title: 09-分叉

date: 2023-06-15	

categories: 比特币	

tags: [区块链,比特币]
---	

# 分叉(fork)形成的原因

1. 挖矿时两个节点差不多同时挖出矿，都会发布区块(对比特币系统当前状态产生分歧导致的分叉
2. 分叉攻击，同样也会导致分叉(forking attack，人为故意造成)
3. 比特币协议改变，在分布式系统中不能保证所有节点同时升级软件，假设存在少数节点未升级，导致出现分叉

# 硬分叉(hard fork)：旧结点不认可新结点

> 什么情况会出现硬分叉？
> 对比特币协议增加新协议，扩展新功能，未升级软件的旧节点会不认可这些修改，会认为这些特性是非法的。这也就是对比特币协议内容产生分歧，从而导致分叉。

#### 典型例子，就是对比特币区块大小的修改

假设将区块大小从1MB增大至4MB，系统中大多数节点更新了软件，少数节点仍然遵从1MB限制的协议(注意，这里大多数和少数是按照算力来区分的

![image-20230102104357355](/noteimg/C:/Users/zhuba/Desktop/PersonalBlog/source/_posts/区块链/比特币/img/image-20230102104357355.png) 

此时，就出现了新节点永远沿着上面的链挖矿，旧节点永远沿着下面的链挖矿，由于新节点算力足够强，所以形成两条永远都在延伸且平行的链。当然，上面的链，也有可能会挖出大小在1MB内的小区块，但对旧节点来说，该链上存在非法区块，不会认可该链。可见，这种分叉是持久性的。
只要这部分旧节点永远不更新软件，下面的链便永远不会消失。

# 软分叉(soft fork)：新结点不认可旧结点

如果对BTC协议添加限制，使得原本合法交易在新交易中不合法，便会形成软分叉。

假设将区块大小从1MB减小至0.5MB(实际中，1MB已经足够小，不会调小了)，系统中大多数节点更新了软件，少数节点仍然遵从1MB限制的协议(注意，这里大多数和少数是按照算力来区分的

![image-20230102105312754](/noteimg/C:/Users/zhuba/Desktop/PersonalBlog/source/_posts/区块链/比特币/img/image-20230102105312754.png) 

新节点会认为该旧节点挖出区块超过0.5MB限制，为一个非法区块，不会认可该区块，会从其前一个小区块开始挖矿。而旧节点认可新区块，最终会造成5中的效果(绿色大节点为旧节点)，旧节点挖出的区块一直被抛弃，无法得到出块奖励(不在最长合法链上)。这就逼迫旧节点升级软件，最终会实现区块链上的所有矿工共同认可新协议，实现软件协议的升级。

> 需要注意的是，旧节点如果不升级软件，挖出的区块可能就白挖了(大于0.5MB)，但对于系统来说，不会存在永久性分叉。