---
title: 04-具体实现

date: 2023-05-29	

categories: 比特币	

tags: [区块链,比特币]
---	

# 区块链：去中心化账

## 比特币(BTC)：基于交易的账本模式

### **UTXO(Unspent Transaction Output)**：尚未被花掉的交易输出的数据结构，在比特币系统中，由全节点维护，UTXO集合中每个元素要给出产生这个输出的交易的哈希值，以及其在交易中是第几个输出。通过这两个信息，便可以定位到UTXO中的输出，防范“双花攻击”

> 每个交易会消耗输出，但也会产生新的输出
>
> 例如：A转给B5个BTC，之后B将其转给D，则UTXO中会删掉A->B这一交易记录，同时会添加B->D这一交易记录

每个交易**可以有多个输入**，也可以**有多个输出**，但输入之和要等于输出之和（total inputs = total outputs）,存在一些交易的total inputs 略大于 total outputs，这部分差额便作为交易费，给了获得记账权的节点

BTC系统中每21万个区块，BTC出块奖励减半。根据下图计算，基本上出块**奖励每4年减半**

## 以太坊(ETH)：基于账户的模式

系统中显示记录账户余额，可以看到，比特币这种模式，隐私性较好，但其也付出一定代价。在进行交易时，因为没有账户这一概念，无法知道账户剩余多少BTC,所以必须说明币的来源（防止双花攻击）。而基于账户的模式，则天然地避免了这种缺陷，转账交易就是对一个（多个）账户余额的数字减和另一个（多个）账户余额的数字加

## BTH的具体示例（blockchain.info）

![image-20221231215811539](/noteimg/C:/Users/zhuba/Desktop/PersonalBlog/source/_posts/区块链/比特币/img/image-20221231215811539.png) 

## BTH交易示例

![image-20221231213303050](/noteimg/C:/Users/zhuba/Desktop/PersonalBlog/source/_posts/区块链/比特币/img/image-20221231213303050.png)

## 什么是挖矿？

可以看到，区块哈希与前一区块哈希都是以一长串0开头的，挖矿本身就是尝试各种nonce，使得产生的区块哈希值小于等于目标阈值，该目标阈值，表示成16进制，就是前面含有一长串的0，每次尝试nonce，可以视为一次伯努利试验，成功的概率极小，失败的概率极大，伯努利试验本身具有无记忆性。也就是说，无论之前做多少大量试验，对后续继续试验没有任何影响.

nonce是一个32位的无符号整型数据，在挖矿时候是通过不断调整nonce进行的，但可以看到，nonce的取值最多为2^32(2的32次方)种。但并非将这些nonce全部遍历一遍，就一定能找到符合要求的nonce。由于近年来，挖矿人员越来越多，挖矿难度已经调整的比较大了，而2^32这一搜索空间太小，所以仅调整nonce很大可能找不到正确的结果。区块中发布一个区块时会有一个铸币交易(coinbase交易)里有一CoinBase域，其中可以写入任何内容，在这里写什么都没有影响，所以，只要我们改变了写入内容，便可以改变Merkle Tree 的根哈希值。所以，在实际的挖矿中，包含两层循环。外层循环调整coinbase域（可以规定只将其中前x个字节作为另一个nonce），算出block header中根哈希值后，内层循环再调整nonce。

## 比特币系统安全性分析

> 算力低的用户并非完全不能获得记账权，仅仅是概率上较低的问题

> 比特币协议中，缺省需要等6个确认区块，此时才认为该记录是不可篡改的